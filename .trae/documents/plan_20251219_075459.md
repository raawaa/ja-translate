# 为双语对照翻译添加样式区分

## 问题分析
用户要求在翻译程序运行时，直接在translated目录下创建CSS文件，而不是在source目录下创建。CSS文件应该和原书的CSS文件放在同一层级（OEBPS目录下）。

## 解决方案
1. **修改epub_translator.py**：在处理HTML文件之前，检查translated目录下是否存在CSS文件，如果不存在则创建
2. **更新CSS创建逻辑**：在翻译过程中，在translated目录下创建CSS文件
3. **确保HTML文件引用正确**：修改HTML处理逻辑，确保每个HTML文件都引用了CSS文件

## 实现步骤

### 1. 修改epub_translator.py
在处理HTML文件之前，添加创建CSS文件的逻辑：

```python
# 在处理HTML文件之前，检查并创建CSS文件
bilingual_css_path = translated_dir / "OEBPS/bilingual.css"
if not bilingual_css_path.exists():
    print(f"📄 创建CSS文件: {bilingual_css_path}")
    # 创建CSS文件内容
    css_content = """/* 双语对照样式 */
/* 容器样式（保留类名，无样式） */
.bilingual-container {
    /* 容器样式可在后续扩展 */
}

/* 原文样式 - 淡化处理 */
.original-text {
    color: #666;
}

/* 译文样式（保留类名，无样式） */
.translated-text {
    /* 译文样式可在后续扩展 */
}"""
    # 确保目录存在
    bilingual_css_path.parent.mkdir(parents=True, exist_ok=True)
    # 写入CSS内容
    with open(bilingual_css_path, 'w', encoding='utf-8') as f:
        f.write(css_content)
    print(f"✅ CSS文件创建成功")
```

### 2. 修改HTML处理逻辑
确保每个HTML文件都引用了CSS文件：

```python
# 检查HTML文件是否已经引入了CSS文件
if 'bilingual.css' not in html_content:
    # 在head标签中添加CSS引用
    if '<head>' in html_content:
        html_content = html_content.replace('<head>', '<head>\n<link rel="stylesheet" href="bilingual.css" type="text/css" />', 1)
    else:
        # 如果没有head标签，在html标签后添加
        html_content = html_content.replace('<html>', '<html>\n<head>\n<link rel="stylesheet" href="bilingual.css" type="text/css" />\n</head>', 1)
```

## 预期效果
- CSS文件在翻译程序运行时直接创建在translated目录下
- CSS文件和原书的CSS文件放在同一层级
- 每个HTML文件都正确引用了CSS文件
- 原文显示为灰色，译文保持默认样式

## 文件修改列表
1. `epub_translator.py`：添加CSS创建逻辑
2. 确保HTML处理逻辑中包含CSS引用添加

## 注意事项
- 确保CSS文件路径与项目的实际目录结构一致
- 考虑到不同EPUB阅读器的兼容性，使用基础的CSS属性
- 只设置原文的字体颜色，不添加其他样式